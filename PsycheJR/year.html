<!-- /*
* year.html
* 
* This year.html contains the content that the users can interact with to figure out what life would be like on 
* Psyche for a year. There are other forms of interaction like figuring out your age on Psyche vs Earth.
* 
* Class:      SER 402
* Team:       35
* Project:    NASA Psyche Mission: Year on Psyche Simulation
* Authors:    Armando Arratia, Dan McNeil, Jenny Potocki, Josh Anselm, Tyler Brown
* Date:       1/22/25
* Revision:   1.0
*

========================================================================================================
File Start
========================================================================================================

-->

<!-- Declarations  -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="./CSS/yearPage.css"/>
  <title>Year on Psyche Mobile</title>
</head>
<body>

  <main id="main-background">

    <section id="top">
      <p>How old would you be if you were born on Psyche?</p>
    </section>

    <div class="age-container">
      <div id="yearSelection" class="column">
        <h3>Scroll to your birth year:</h3>
        <div class="scroll-wheel" id="scrollWheel">
          <ul id="yearList"></ul>
        </div>
      </div>

      <div id="ageOnEarth" class="column">
        <h3>Age on Earth</h3>
        <p id="earthResult"></p>
      </div>

      <div id="ageOnPsyche" class="column">
        <h3>Age on Psyche</h3>
        <p id="psycheResult"></p>
      </div>
    </div>

    <section id="middle">
      <p>Select a day type</p>
    </section>

    <div class="wrap">
      <input type="radio" id="Earth" name="sort" checked />
      <label for="Earth">Earth</label>
      <input type="radio" id="Psyche" name="sort" />
      <label for="Psyche">Psyche</label>
    </div>

    <div id="resultHours"></div>
    <div id="piechart"></div>

    <div class="columnLarge" id="results">
      <div id="work"><p id="resultWork"></p></div>
      <div id="school"><p id="resultSchool"></p></div>
      <div id="eat"><p id="resultEat"></p></div>
      <div id="relax"><p id="resultRelax"></p></div>
      <div id="sleep"><p id="resultSleep"></p></div>
    </div>

  </main>

  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script>
    const yearList = document.getElementById('yearList');
    const scrollWheel = document.getElementById('scrollWheel');
    const currentYear = new Date().getFullYear();

    for (let year = 2025; year >= 1925; year--) {
      const li = document.createElement('li');
      li.textContent = year;
      yearList.appendChild(li);
    }

    // Add a spacer element so final item can scroll into view
    const spacer = document.createElement('li');
    spacer.style.height = '120px'; // or match scroll-wheel height
    spacer.style.border = 'none';
    spacer.style.background = 'transparent';
    yearList.appendChild(spacer);

    scrollWheel.addEventListener('scroll', () => {
      const scrollTop = scrollWheel.scrollTop;
      const itemHeight = 32;
      const selectedIndex = Math.round(scrollTop / itemHeight);
      const selectedYear = yearList.children[selectedIndex].textContent;

      Array.from(yearList.children).forEach((li, index) => {
        li.classList.toggle('selected', index === selectedIndex);
        if (index === selectedIndex) {
          li.scrollIntoView({
            behavior: 'smooth',
            block: 'center'
          });
        }
      });

      const earthAge = currentYear - selectedYear;
      const psycheAge = Math.floor(earthAge / 5);

      document.getElementById('earthResult').innerText = `${earthAge}`;
      document.getElementById('earthResult').className = `earthAge`;
      document.getElementById('psycheResult').innerText = `${psycheAge}`;
      document.getElementById('psycheResult').className = `psycheAge`;
    });

    scrollWheel.scrollTop = 0;
    yearList.children[0].classList.add('selected');

    const earthData = { Sleep: 8, "Work/School": 8, Eat: 3, Relax: 5 };
    const psycheData = { Sleep: 1, "Work/School": 1, Eat: 0.7, Relax: 1.5 };

    function drawResponsivePie(data) {
      const container = document.getElementById("piechart");
      container.innerHTML = "";

      const containerWidth = container.offsetWidth || 300;
      const maxWidth = Math.min(containerWidth, 600);
      const width = maxWidth;
      const height = maxWidth;
      const radius = width / 2 - 20;

      const svg = d3.select("#piechart")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("viewBox", `0 0 ${width} ${height}`)
        .attr("preserveAspectRatio", "xMidYMid meet")
        .append("g")
        .attr("transform", `translate(${width / 2}, ${height / 2})`);

      const color = d3.scaleOrdinal()
        .domain(Object.keys(data))
        .range(d3.schemeDark2);

      const pie = d3.pie().value(d => d.value);
      const data_ready = pie(d3.entries(data));
      const arc = d3.arc().innerRadius(0).outerRadius(radius);

      svg.selectAll("path")
        .data(data_ready)
        .enter()
        .append("path")
        .attr("d", arc)
        .attr("fill", d => color(d.data.key))
        .attr("stroke", "white")
        .style("stroke-width", "2px")
        .style("opacity", 1);

      const textGroup = svg.selectAll(".textGroup")
        .data(data_ready)
        .enter()
        .append("g")
        .attr("class", "textGroup")
        .attr("transform", d => `translate(${arc.centroid(d)})`);

      textGroup.append("text")
        .attr("class", "keyText")
        .attr("dy", "-0.6em")
        .text(d => d.data.key)
        .attr("text-anchor", "middle")
        .style("fill", "#fff")
        .style("font-size", `${Math.max(width / 25, 12)}px`);

      textGroup.append("text")
        .attr("class", "valueText")
        .attr("dy", "0.6em")
        .text(d => d.data.value)
        .attr("text-anchor", "middle")
        .style("fill", "#fff")
        .style("font-size", `${Math.max(width / 20, 14)}px`);
    }

    function updateChart(data) {
      drawResponsivePie(data);
    }

    drawResponsivePie(earthData);

    document.getElementById('Earth').addEventListener('change', () => {
      updateChart(earthData);
      document.getElementById('resultWork').textContent = '8 Hours of Work';
      document.getElementById('resultSchool').textContent = '8 Hours of School';
      document.getElementById('resultSleep').textContent = '8 Hours of Sleep';
      document.getElementById('resultEat').textContent = '3 Hours to Eat';
      document.getElementById('resultRelax').textContent = '5 Hours to Relax';
      document.getElementById('resultHours').textContent = '24 Hours Each Day';
    });

    document.getElementById('Psyche').addEventListener('change', () => {
      updateChart(psycheData);
      document.getElementById('resultWork').textContent = '1 Hour of Work';
      document.getElementById('resultSchool').textContent = '1 Hour of School';
      document.getElementById('resultSleep').textContent = '1 Hour of Sleep';
      document.getElementById('resultEat').textContent = '45 Mins to Eat';
      document.getElementById('resultRelax').textContent = '1.5 Hours to Relax';
      document.getElementById('resultHours').textContent = '4.2 Hours Each Day';
    });

    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        const checked = document.querySelector('input[name="sort"]:checked').id;
        drawResponsivePie(checked === "Earth" ? earthData : psycheData);
      }, 200);
    });
  </script>

</body>
</html>